<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL AI Rater 2025 | Live Edition</title>
    <style>
        :root {
            --pitch-green: #27ae60;
            --pitch-line: rgba(255, 255, 255, 0.4);
            --dark-bg: #121212;
            --accent: #3498db;
            --gold: #f1c40f;
            --error: #e74c3c;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--dark-bg);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .container { max-width: 600px; width: 100%; text-align: center; }
        
        /* HEADER & STATUS */
        h1 { margin-bottom: 5px; color: var(--gold); letter-spacing: -1px; }
        .status-bar { font-size: 12px; margin-bottom: 15px; padding: 5px; border-radius: 5px; background: #222; }
        .budget-bar { font-weight: bold; font-size: 1.1rem; margin-bottom: 15px; }

        /* PITCH STYLES */
        .pitch {
            background: var(--pitch-green);
            background-image: linear-gradient(var(--pitch-line) 2px, transparent 2px), linear-gradient(90deg, var(--pitch-line) 2px, transparent 2px);
            background-size: 100% 50%, 50% 100%;
            border: 4px solid white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 20px 10px;
            height: 520px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            position: relative;
        }

        .position-row { display: flex; justify-content: center; gap: 8px; }

        .player-slot {
            width: 90px;
            background: rgba(0, 0, 0, 0.75);
            border-bottom: 3px solid var(--accent);
            border-radius: 6px;
            padding: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .player-slot label { font-size: 10px; font-weight: 800; color: #888; margin-bottom: 4px; }

        select {
            width: 100%;
            background: transparent;
            color: white;
            border: none;
            font-size: 11px;
            outline: none;
            cursor: pointer;
            text-align: center;
        }

        /* DASHBOARD */
        .dashboard {
            margin-top: 25px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 15px;
            border: 1px solid #333;
        }

        .score-circle { font-size: 56px; font-weight: 900; color: var(--accent); }
        .insight-box {
            margin: 15px 0;
            padding: 12px;
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid var(--accent);
            font-size: 14px;
            text-align: left;
            line-height: 1.4;
        }

        /* BUTTONS */
        .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-main { background: var(--accent); color: white; grid-column: span 2; font-size: 1.1rem; }
        .btn-sync { background: #27ae60; color: white; }
        .btn-opt { background: var(--gold); color: black; }
        .btn-reset { background: #444; color: white; grid-column: span 2; }
        
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>AI TEAM RATER</h1>
    <div class="status-bar" id="sync-status">Database: Initializing...</div>
    
    <div class="budget-bar">
        Remaining Budget: <span id="budget-val">¬£100.0m</span>
    </div>

    <div class="pitch">
        <div class="position-row">
            <div class="player-slot" data-pos="GKP"><label>GKP</label></div>
        </div>
        <div class="position-row">
            <div class="player-slot" data-pos="DEF"><label>DEF</label></div>
            <div class="player-slot" data-pos="DEF"><label>DEF</label></div>
            <div class="player-slot" data-pos="DEF"><label>DEF</label></div>
            <div class="player-slot" data-pos="DEF"><label>DEF</label></div>
        </div>
        <div class="position-row">
            <div class="player-slot" data-pos="MID"><label>MID</label></div>
            <div class="player-slot" data-pos="MID"><label>MID</label></div>
            <div class="player-slot" data-pos="MID"><label>MID</label></div>
            <div class="player-slot" data-pos="MID"><label>MID</label></div>
        </div>
        <div class="position-row">
            <div class="player-slot" data-pos="FWD"><label>FWD</label></div>
            <div class="player-slot" data-pos="FWD"><label>FWD</label></div>
        </div>
    </div>

    <div class="button-group">
        <button class="btn-main" onclick="runAITeamRating()">Analyze Team</button>
        <button class="btn-sync" onclick="fetchCurrentData()">üîÑ Live Sync</button>
        <button class="btn-opt" onclick="optimizeTeam()">‚ö° Auto-Fill</button>
        <button class="btn-reset" onclick="resetPitch()">Reset Pitch</button>
    </div>

    <div id="results" class="dashboard hidden">
        <div id="ai-score" class="score-circle">0</div>
        <div style="font-size: 12px; color: #888; margin-top: -5px;">AI EFFICIENCY RATING</div>
        <p id="predicted-points" style="font-weight:bold; margin: 10px 0;">Projected: 0.0 pts</p>
        <div class="insight-box" id="ai-insight">Selecting players...</div>
        <button class="btn-main" style="background:#9b59b6;" onclick="recommendTransfer()">üí° Suggest Transfer</button>
    </div>
</div>

<script>
    let playerDatabase = [];

    // 1. DATA SYNC: Pull from Live FPL API 2025/26
    async function fetchCurrentData() {
        const status = document.getElementById('sync-status');
        status.textContent = "Syncing with FPL Servers (2025/26)...";
        
        const fplUrl = 'https://fantasy.premierleague.com/api/bootstrap-static/';
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(fplUrl)}`;

        try {
            const response = await fetch(proxyUrl);
            const wrapper = await response.json();
            const data = JSON.parse(wrapper.contents);

            playerDatabase = data.elements.map(p => ({
                name: p.web_name,
                pos: ["", "GKP", "DEF", "MID", "FWD"][p.element_type],
                team: data.teams.find(t => t.id === p.team).short_name,
                xp: parseFloat(p.ep_next) || 0,
                form: parseFloat(p.form) || 0,
                price: p.now_cost / 10
            })).sort((a,b) => b.xp - a.xp);

            status.textContent = `‚úÖ Live Data Loaded (GW17). Total Players: ${playerDatabase.length}`;
            status.style.color = "#27ae60";
            initDropdowns();
        } catch (err) {
            status.textContent = "‚ùå Sync Failed. Using backup data.";
            status.style.color = "#e74c3c";
        }
    }

    // 2. UI: Populate Dropdowns
    function initDropdowns() {
        const slots = document.querySelectorAll('.player-slot');
        slots.forEach((slot, i) => {
            const pos = slot.dataset.pos;
            let select = slot.querySelector('select');
            if(!select) {
                select = document.createElement('select');
                select.id = `slot-${i}`;
                select.onchange = updateBudget;
                slot.appendChild(select);
            }
            
            select.innerHTML = `<option value="">Select...</option>`;
            playerDatabase.filter(p => p.pos === pos).slice(0, 50).forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.name;
                opt.textContent = `${p.name} (${p.price}m)`;
                select.appendChild(opt);
            });
        });
    }

    // 3. LOGIC: Budget Tracker
    function updateBudget() {
        let spent = 0;
        document.querySelectorAll('select').forEach(s => {
            const p = playerDatabase.find(player => player.name === s.value);
            if(p) spent += p.price;
        });
        const remaining = (100 - spent).toFixed(1);
        const el = document.getElementById('budget-val');
        el.textContent = `¬£${remaining}m`;
        el.style.color = remaining < 0 ? "#e74c3c" : "#2ecc71";
    }

    // 4. LOGIC: AI Rater Engine
    function runAITeamRating() {
        const selects = document.querySelectorAll('select');
        const team = [];
        let totalCost = 0;
        selects.forEach(s => {
            if(s.value) {
                const p = playerDatabase.find(player => player.name === s.value);
                team.push(p);
                totalCost += p.price;
            }
        });

        if(team.length < 11) return alert("Fill all 11 slots for AI analysis!");

        document.getElementById('results').classList.remove('hidden');
        
        let totalXP = team.reduce((acc, p) => acc + p.xp, 0);
        let rating = (totalXP / 65) * 100; // Scaled to current 2025 performance levels
        
        if(totalCost > 100) rating -= (totalCost - 100) * 15; // Heavy budget penalty

        animateScore(Math.max(0, Math.min(99.9, rating)));
        document.getElementById('predicted-points').textContent = `Projected: ${totalXP.toFixed(1)} pts this GW`;
        document.getElementById('ai-insight').innerHTML = generateInsight(team);
    }

    function generateInsight(team) {
        const afcon = team.filter(p => ["Salah", "Mbeumo", "Kudus", "Semenyo"].includes(p.name));
        if(afcon.length > 0) return `‚ö†Ô∏è <b>AFCON Alert:</b> ${afcon.map(p => p.name).join(', ')} are departing soon. Monitor their status.`;
        return "‚úÖ <b>AI Profile:</b> High-value structure. No immediate red flags detected.";
    }

    function animateScore(target) {
        let curr = 0;
        const el = document.getElementById('ai-score');
        const interval = setInterval(() => {
            if(curr >= target) { el.textContent = target.toFixed(1); clearInterval(interval); }
            else { el.textContent = (curr += 2.5).toFixed(1); }
        }, 30);
    }

    // 5. LOGIC: Auto-Optimizer (Greedy Algorithm)
    function optimizeTeam() {
        const selects = document.querySelectorAll('select');
        let budget = 100.0;
        
        selects.forEach(s => {
            const pos = s.parentElement.dataset.pos;
            const best = playerDatabase.find(p => p.pos === pos && p.price <= (budget / 5) && !Array.from(selects).some(sel => sel.value === p.name));
            if(best) {
                s.value = best.name;
                budget -= best.price;
            }
        });
        updateBudget();
        runAITeamRating();
    }

    // 6. LOGIC: Transfer Suggestion
    function recommendTransfer() {
        const selects = Array.from(document.querySelectorAll('select'));
        const team = selects.map(s => playerDatabase.find(p => p.name === s.value)).filter(Boolean);
        const weakest = team.reduce((prev, curr) => (prev.xp < curr.xp) ? prev : curr);
        
        const better = playerDatabase.find(p => p.pos === weakest.pos && p.price <= weakest.price && p.xp > weakest.xp && !team.some(t => t.name === p.name));
        
        const box = document.getElementById('ai-insight');
        if(better) {
            box.innerHTML = `üí° <b>Rec:</b> Replace <b>${weakest.name}</b> with <b>${better.name}</b>. <br>Gain: +${(better.xp - weakest.xp).toFixed(1)} expected points.`;
        } else {
            box.textContent = "Your team is currently optimized for your budget.";
        }
    }

    function resetPitch() {
        document.querySelectorAll('select').forEach(s => s.value = "");
        document.getElementById('results').classList.add('hidden');
        updateBudget();
    }

    // Auto-sync on load
    fetchCurrentData();
</script>

</body>
</html>
