<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Gameweek Wrapped</title>
Â  <style>
Â  Â  /* --- Global Reset & Base Styles --- */
Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â Â 
Â  Â  body {
Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
Â  Â  Â  background: #0a0a0b;
Â  Â  Â  color: #fafafa;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  padding: 2rem 1rem;
Â  Â  }
Â  Â Â 
Â  Â  .container { max-width: 900px; margin: 0 auto; }
Â  Â Â 
Â  Â  /* --- Header Styles --- */
Â  Â  .header { text-align: center; margin-bottom: 2rem; }
Â  Â Â 
Â  Â  .badge {
Â  Â  Â  display: inline-block;
Â  Â  Â  background: #27272a;
Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  border-radius: 9999px;
Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }
Â  Â Â 
Â  Â  .title {
Â  Â  Â  font-size: 1.875rem;
Â  Â  Â  font-weight: 700;
Â  Â  Â  /* Using solid purple for better contrast */
Â  Â  Â  background: #8b5cf6; 
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }
Â  Â Â 
Â  Â  .subtitle { color: #a1a1aa; }
Â  Â Â 
Â  Â  /* --- Grid & Card Styles --- */
Â  Â  .stats-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  gap: 1rem;
Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  }
Â  Â Â 
Â  Â  .card {
Â  Â  Â  background: rgba(39, 39, 42, 0.5);
Â  Â  Â  border: 1px solid rgba(63, 63, 70, 0.5);
Â  Â  Â  border-radius: 0.75rem;
Â  Â  Â  padding: 1.25rem;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â Â 
Â  Â  .card:hover {
Â  Â  Â  transform: translateY(-4px);
Â  Â  Â  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
Â  Â  }
Â  Â Â 
Â  Â  .card-header {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 0.75rem;
Â  Â  }
Â  Â Â 
Â  Â  .icon-wrapper {
Â  Â  Â  background: rgba(139, 92, 246, 0.1);
Â  Â  Â  color: #8b5cf6;
Â  Â  Â  padding: 0.5rem;
Â  Â  Â  border-radius: 0.5rem;
Â  Â  }
Â  Â Â 
Â  Â  .icon-wrapper svg { width: 20px; height: 20px; }
Â  Â Â 
Â  Â  .highlight {
Â  Â  Â  font-size: 0.75rem;
Â  Â  Â  border: 1px solid #3f3f46;
Â  Â  Â  padding: 0.125rem 0.5rem;
Â  Â  Â  border-radius: 9999px;
Â  Â  Â  background-color: rgba(63, 63, 70, 0.3);
Â  Â  }
Â  Â Â 
Â  Â  .stat-label {
Â  Â  Â  font-size: 0.75rem;
Â  Â  Â  color: #71717a;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 0.05em;
Â  Â  Â  margin-bottom: 0.25rem;
Â  Â  }
Â  Â Â 
Â  Â  .stat-value { font-size: 1.5rem; font-weight: 700; line-height: 1.2; }
Â  Â Â 
Â  Â  .stat-subtitle { font-size: 0.875rem; color: #a1a1aa; margin-top: 0.25rem; }
Â  Â Â 
Â  Â  /* --- Chip Section Styles --- */
Â  Â  .chip-section { margin-top: 1.5rem; }
Â  Â Â 
Â  Â  .chip-title {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  Â  font-size: 1.125rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  }
Â  Â Â 
Â  Â  .chip-title svg { color: #8b5cf6; }
Â  Â Â 
Â  Â  .chip-item { margin-bottom: 1rem; }
Â  Â Â 
Â  Â  .chip-row {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  margin-bottom: 0.35rem;
Â  Â  }
Â  Â Â 
Â  Â  .chip-name { font-weight: 500; }
Â  Â  .chip-count { color: #a1a1aa; font-weight: 600; }
Â  Â Â 
Â  Â  .progress-bar {
Â  Â  Â  height: 0.5rem;
Â  Â  Â  background: #27272a;
Â  Â  Â  border-radius: 9999px;
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â Â 
Â  Â  .progress-fill {
Â  Â  Â  height: 100%;
Â  Â  Â  background: #8b5cf6;
Â  Â  Â  border-radius: 9999px;
Â  Â  Â  transition: width 0.5s ease;
Â  Â  }

Â  Â  /* --- Loading State (Skeleton) Styles --- */
Â  Â  @keyframes pulse {
Â  Â  Â  0% { background-color: rgba(63, 63, 70, 0.5); }
Â  Â  Â  50% { background-color: rgba(63, 63, 70, 0.7); }
Â  Â  Â  100% { background-color: rgba(63, 63, 70, 0.5); }
Â  Â  }

Â  Â  .skeleton {
Â  Â  Â  animation: pulse 1.5s infinite ease-in-out;
Â  Â  Â  border-radius: 4px;
Â  Â  }

Â  Â  .skeleton-line {
Â  Â  Â  height: 0.75rem;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  }

Â  Â  .skeleton-value {
Â  Â  Â  height: 1.5rem;
Â  Â  Â  width: 70%;
Â  Â  Â  margin-bottom: 0.25rem;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header">
Â  Â  Â  <span class="badge" id="gameweekBadge">Loading...</span>
Â  Â  Â  <h1 class="title">Gameweek Wrapped</h1>
Â  Â  Â  <p class="subtitle">Key stats and highlights from this gameweek</p>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="stats-grid" id="statsGrid">
Â  Â  Â  Â  Â  </div>
Â  Â Â 
Â  Â  <div class="card chip-section">
Â  Â  Â  <div class="chip-title">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>
Â  Â  Â  Â  Chip Usage Breakdown
Â  Â  Â  </div>
Â  Â  Â  <div id="chipBreakdown">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // --- API and Utility Constants ---
Â  Â  // FIX FOR NETLIFY HOSTING: 
Â  Â  // This local path relies on a proxy redirect rule defined in 
Â  Â  // your project's root _redirects file to bypass the FPL API's CORS policy.
Â  Â  const FPL_API_URL = '/api/bootstrap-static/'; 
Â  Â Â 
Â  Â  const statsGrid = document.getElementById('statsGrid');
Â  Â  const chipBreakdown = document.getElementById('chipBreakdown');
Â  Â  const gameweekBadge = document.getElementById('gameweekBadge');

Â  Â  // Re-useable SVG Icons (unchanged)
Â  Â  const icons = {
Â  Â  Â  star: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>',
Â  Â  Â  trending: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>',
Â  Â  Â  trophy: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>',
Â  Â  Â  zap: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>'
Â  Â  };

Â  Â  // Helper to format large numbers (unchanged)
Â  Â  const formatNumber = (num) => {
Â  Â  Â  if (num >= 1000000) {
Â  Â  Â  Â  return (num / 1000000).toFixed(1) + 'M';
Â  Â  Â  }
Â  Â  Â  if (num >= 1000) {
Â  Â  Â  Â  return (num / 1000).toFixed(1) + 'K';
Â  Â  Â  }
Â  Â  Â  return num.toString();
Â  Â  };

Â  Â  // --- Rendering Functions ---

Â  Â  /**
Â  Â  Â * Renders a skeleton loading state for the stats grid.
Â  Â  Â */
Â  Â  const renderStatsSkeleton = () => {
Â  Â  Â  Â  statsGrid.innerHTML = Array(4).fill().map(() => `
Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="icon-wrapper skeleton" style="width: 3rem; height: 3rem; border-radius: 0.5rem;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="highlight skeleton" style="width: 30%; height: 1.25rem;"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-line skeleton" style="width: 50%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-value skeleton"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-line skeleton" style="width: 60%;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `).join('');
Â  Â  };

Â  Â  /**
Â  Â  Â * Renders the main statistics cards to the DOM.
Â  Â  Â * @param {Array<Object>} stats - Array of stat objects to display.
Â  Â  Â */
Â  Â  const renderStats = (stats) => {
Â  Â  Â  statsGrid.innerHTML = ''; // Clear skeleton
Â  Â  Â  stats.forEach(stat => {
Â  Â  Â  Â  statsGrid.innerHTML += `
Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  <div class="icon-wrapper">${icons[stat.icon] || icons.zap}</div>
Â  Â  Â  Â  Â  Â  Â  <span class="highlight">${stat.highlight}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="stat-label">${stat.title}</p>
Â  Â  Â  Â  Â  Â  <p class="stat-value">${stat.value}</p>
Â  Â  Â  Â  Â  Â  <p class="stat-subtitle">${stat.subtitle}</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  });
Â  Â  };

Â  Â  /**
Â  Â  Â * Renders the chip usage breakdown to the DOM.
Â  Â  Â * @param {Array<Object>} chips - Array of chip usage objects.
Â  Â  Â */
Â  Â  const renderChips = (chips) => {
Â  Â  Â  chipBreakdown.innerHTML = ''; // Clear previous content
Â  Â  Â  if (chips.length === 0) {
Â  Â  Â  Â  chipBreakdown.innerHTML = '<p class="stat-subtitle">Chip data unavailable or failed to load.</p>';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  chips.forEach(chip => {
Â  Â  Â  Â  chipBreakdown.innerHTML += `
Â  Â  Â  Â  Â  <div class="chip-item">
Â  Â  Â  Â  Â  Â  <div class="chip-row">
Â  Â  Â  Â  Â  Â  Â  <span class="chip-name">${chip.name}</span>
Â  Â  Â  Â  Â  Â  Â  <span class="chip-count">${chip.count}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="progress-bar">
Â  Â  Â  Â  Â  Â  Â  <div class="progress-fill" style="width: ${chip.percentage}%"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  });
Â  Â  };

Â  Â  // --- Data Processing Function ---

Â  Â  /**
Â  Â  Â * Finds the current Gameweek and updates the badge.
Â  Â  Â * @param {Array<Object>} events - The events array from the API.
Â  Â  Â */
Â  Â  const findCurrentGameweek = (events) => {
Â  Â  Â  Â  // Find the current *or* next event if the current one is finished
Â  Â  Â  Â  const currentEvent = events.find(e => e.is_current || e.is_next);
Â  Â  Â  Â  if (currentEvent) {
Â  Â  Â  Â  Â  Â  gameweekBadge.textContent = `Gameweek ${currentEvent.id}`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  gameweekBadge.textContent = `Gameweek N/A`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  /**
Â  Â  Â * Processes raw API data to calculate the required statistics.
Â  Â  Â * @param {Object} data - The raw data object from the FPL API.
Â  Â  Â * @returns {Array<Object>} - The formatted array of stat objects.
Â  Â  Â */
Â  Â  const processFplData = (data) => {
Â  Â  Â  Â  const players = data.elements;
Â  Â  Â  Â  const teams = data.teams;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Helper to find team name by ID
Â  Â  Â  Â  const getTeamShortName = (teamId) => {
Â  Â  Â  Â  Â  Â  const team = teams.find(t => t.id === teamId);
Â  Â  Â  Â  Â  Â  return team ? team.short_name : 'N/A';
Â  Â  Â  Â  };

Â  Â  Â  Â  // 1. Most Bought Player (uses transfers_in_event)
Â  Â  Â  Â  const mostBought = players.reduce((max, p) => p.transfers_in_event > max.transfers_in_event ? p : max);

Â  Â  Â  Â  // 2. Top Scorer now uses 'event_points' for accurate Gameweek score
Â  Â  Â  Â  const topScorer = players.reduce((max, p) => p.event_points > max.event_points ? p : max);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 3. Most Selected/Captained (using selected_by_percent as a proxy for popularity)
Â  Â  Â  Â  const mostSelected = players.reduce((max, p) => parseFloat(p.selected_by_percent) > parseFloat(max.selected_by_percent) ? p : max);

Â  Â  Â  Â  // 4. Most Sold Player (uses transfers_out_event)
Â  Â  Â  Â  const mostSold = players.reduce((max, p) => p.transfers_out_event > max.transfers_out_event ? p : max);

Â  Â  Â  Â  return [
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  title: "Most Selected Player",Â 
Â  Â  Â  Â  Â  Â  Â  value: `${mostSelected.first_name} ${mostSelected.second_name}`,Â 
Â  Â  Â  Â  Â  Â  Â  subtitle: `${mostSelected.selected_by_percent}% selected overall`,Â 
Â  Â  Â  Â  Â  Â  Â  icon: "star",Â 
Â  Â  Â  Â  Â  Â  Â  highlight: getTeamShortName(mostSelected.team)Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  title: "Most Bought (This GW)",Â 
Â  Â  Â  Â  Â  Â  Â  value: `${mostBought.first_name} ${mostBought.second_name}`,Â 
Â  Â  Â  Â  Â  Â  Â  subtitle: `${formatNumber(mostBought.transfers_in_event)} transfers in`,Â 
Â  Â  Â  Â  Â  Â  Â  icon: "trending",Â 
Â  Â  Â  Â  Â  Â  Â  highlight: getTeamShortName(mostBought.team)Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  title: "Gameweek Top Scorer",Â 
Â  Â  Â  Â  Â  Â  Â  value: `${topScorer.first_name} ${topScorer.second_name}`,Â 
Â  Â  Â  Â  Â  Â  Â  subtitle: `${topScorer.event_points} Points this GW`,Â 
Â  Â  Â  Â  Â  Â  Â  icon: "trophy",Â 
Â  Â  Â  Â  Â  Â  Â  highlight: getTeamShortName(topScorer.team)Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  title: "Most Sold (This GW)",Â 
Â  Â  Â  Â  Â  Â  Â  value: `${mostSold.first_name} ${mostSold.second_name}`,Â 
Â  Â  Â  Â  Â  Â  Â  subtitle: `${formatNumber(mostSold.transfers_out_event)} transfers out`,Â 
Â  Â  Â  Â  Â  Â  Â  icon: "zap",Â 
Â  Â  Â  Â  Â  Â  Â  highlight: getTeamShortName(mostSold.team)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  ];
Â  Â  };


Â  Â  // --- Main Fetch Function ---

Â  Â  /**
Â  Â  Â * Fetches data from the FPL API, processes it, and updates the UI.
Â  Â  Â */
Â  Â  async function getFplData() {
Â  Â  Â  Â  // Set the initial loading state (skeletons)
Â  Â  Â  Â  renderStatsSkeleton();
Â  Â  Â  Â  // Set initial chip data state
Â  Â  Â  Â  renderChips([]);
Â  Â  Â  Â  gameweekBadge.textContent = 'Loading...';

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch(FPL_API_URL);
Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  // Clear previous loading state and show the error
Â  Â  Â  Â  Â  Â  Â  Â  statsGrid.innerHTML = ''; 
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Update Gameweek Badge
Â  Â  Â  Â  Â  Â  findCurrentGameweek(data.events);

Â  Â  Â  Â  Â  Â  // 2. Process and Render Main Stats
Â  Â  Â  Â  Â  Â  const processedStats = processFplData(data);
Â  Â  Â  Â  Â  Â  renderStats(processedStats);

Â  Â  Â  Â  Â  Â  // 3. Render Mock Chip Data
Â  Â  Â  Â  Â  Â  const mockChips = [
Â  Â  Â  Â  Â  Â  Â  { name: "Triple Captain", count: "2.1M", percentage: 45 },
Â  Â  Â  Â  Â  Â  Â  { name: "Bench Boost", count: "1.4M", percentage: 30 },
Â  Â  Â  Â  Â  Â  Â  { name: "Free Hit", count: "890K", percentage: 19 },
Â  Â  Â  Â  Â  Â  Â  { name: "Wildcard", count: "280K", percentage: 6 }
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  renderChips(mockChips);

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Could not fetch FPL data:", error);
Â  Â  Â  Â  Â  Â  gameweekBadge.textContent = 'Data Error';
Â  Â  Â  Â  Â  Â  statsGrid.innerHTML = `<div style="grid-column: 1 / -1; text-align: center; color: #f87171;">
Â  Â  Â  Â  Â  Â  Â  Â  <p>ðŸš¨ Failed to load FPL data. Please check the console for details.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="stat-subtitle" style="margin-top: 0.5rem;">Check your **_redirects** file configuration on Netlify.</p>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  renderChips([]);Â 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Initialize the application when the page loads
Â  Â  window.onload = getFplData;
Â  </script>
</body>
</html>
